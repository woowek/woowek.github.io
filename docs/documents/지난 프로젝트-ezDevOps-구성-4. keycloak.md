---
title: 
parent: Documents
layout: default
---

# 

> Source: `지난 프로젝트/ezDevOps/구성/4. keycloak.md`

---

> keycloak
---


1. 구성
```sh
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm upgrade --install keycloak bitnami/keycloak -n keycloak --create-namespace -f keycloak_values.yaml
```

2. 삭제
```sh
helm uninstall keycloak -n keycloak || true
kubectl delete namespace keycloak --ignore-not-found
```


3. https
- cert_crt.pem, cert_key.pem 을 가지고 작업을 한다 가정한다.
```sh
kubectl create namespace keycloak
kubectl create secret tls keycloak-tls --cert=cert_crt.pem --key=cert_key.pem -n keycloak
```
- values에 관련 설정을 추가한다.
```yaml
extraEnvVars:
  - name: KC_HTTPS_CERTIFICATE_FILE
    value: /etc/x509/https/tls.crt
  - name: KC_HTTPS_CERTIFICATE_KEY_FILE
    value: /etc/x509/https/tls.key
  - name: KC_PROXY
    value: "edge"
  - name: KC_HTTP_PORT
    value: "8080"
  - name: KC_HTTPS_PORT
    value: "8443"
  - name: KC_HOSTNAME
    value: "호스트주소
  - name: KC_HOSTNAME_STRICT
    value: "false"
  - name: KC_HOSTNAME_STRICT_HTTPS
    value: "false"

extraVolumeMounts:
  - name: https-certs
    mountPath: /etc/x509/https
    readOnly: true

extraVolumes:
  - name: https-certs
    secret:
      secretName: keycloak-tls
tls:
  enabled: true
  usePemCerts: true
  autoGenerated:
    enabled: false
  existingSecret: keycloak-tls

containerPorts:
  http: 8080
  https: 8443
```


3. SSO 구성
- 내가 이전에 테스트했던 구성은 keycloak은 loadbalancer, 나머지 연결 서비스는 ingress clusterIP 로 구성했었다.
- 즉 keycloak는 고정된 IP, 나머지 서비스는 URL로 처리했다.
- SSO를 구성할 서비스에는 hostalias를 keycloak URL로 지정해야한다. 서비스마다 values 구조가 다르지만 대략 이런 구조이다.
```yaml
global:
  hostAliases:
    - ip: "KEYCLOAK_IP"
      hostnames:
        - "KEYCLOAK_URL"
```
- 이후 과정은 서비스마다 달라 각 서비스별로 기입힌다.



